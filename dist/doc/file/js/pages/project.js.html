<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">js/pages/project.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/nahidakbar/janus" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-event">event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pageview">pageview</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Create">Create</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Delete">Delete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Read">Read</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Update">Update</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-request">request</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common/schema</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-arrayEditor">arrayEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-arrayViewer">arrayViewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-booleanEditor">booleanEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-booleanViewer">booleanViewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-editor">editor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-viewer">viewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-numberEditor">numberEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-numberViewer">numberViewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-objectEditor">objectEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-objectViewer">objectViewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringEditor">stringEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringViewer">stringViewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringViewerDefault">stringViewerDefault</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-stringViewerImage">stringViewerImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-arrayEditors">arrayEditors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-editors">editors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-viewers">viewers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stringEditors">stringEditors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stringViewers">stringViewers</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">pages</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-index">index</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-indexeddb">indexeddb</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-localstorage">localstorage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-project">project</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">projects</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/projects/IndexedDB.js~IndexedDBStorage.html">IndexedDBStorage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/projects/LocalStorage.js~LocalStorage.html">LocalStorage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/projects/Storage.js~Storage.html">Storage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add">add</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-list">list</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">types</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-md">md</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-stakeholder">stakeholder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-swot">swot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-usecase">usecase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-user">user</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">js/pages/project.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Janus Copyright (C) 2017 Nahid Akbar
 */

&quot;use strict&quot;;

const projects = require(&quot;projects&quot;);
const types = require(&quot;types&quot;);
const naturalSort = require(&quot;javascript-natural-sort&quot;);

import * as analytics from &quot;common/analytics&quot;;

export default function(context)
{
  context.head.text(context.State(&quot;name&quot;).toUncamelCase());
  showFiles(context, projects.get(context.State(&quot;name&quot;)));
}

function showFiles(context, project)
{
  project.listFiles().then(list =&gt;
  {
    let files = {};
    let parent = context.body.clear();
    Object.keys(list)
      .sort(naturalSort)
      .forEach(key =&gt;
      {
        showFile(context, parent.Div(), project, list[key], files);
      });
    newFile(context, parent.Div().Class(&quot;noprint&quot;), project);
  });
}

function newFile(context, parent, project)
{
  parent.H2(&quot;Create New File&quot;);
  parent.Label(&quot;Name: &quot;).Display(&quot;block&quot;);
  let nameInput = parent.Text().Pattern(&quot;^[A-Za-z0-9\-_]+$&quot;).Display(&quot;block&quot;);
  parent.Label(&quot;Type: &quot;).Display(&quot;block&quot;);
  let typeInput = parent.Select().Options(getTypes()).Display(&quot;block&quot;);
  parent.Label(&quot;Template: &quot;).Display(&quot;block&quot;);
  let templateInput = parent.Select().Options(getTypeDefaults(typeInput.Value())).Display(&quot;block&quot;);
  typeInput.OnChange(() =&gt;
  {
    analytics.event(typeInput.Value(), &quot;select&quot;);
    templateInput.Options(getTypeDefaults(typeInput.Value()));
  });
  templateInput.OnChange(() =&gt;
  {
    analytics.event(typeInput.Value(), &quot;select&quot;, templateInput.Value());
  });
  parent.Button(&quot;Create&quot;).OnClick(() =&gt;
  {
    let name = nameInput.Value();
    let type = typeInput.Value();
    let template = templateInput.Value();
    analytics.event(type, &quot;create&quot;, template);
    if (name &amp;&amp; nameInput.Validity().valid)
    {
      project.setFile(project.makeKey(name, type), types[type].templates[template])
        .then(() =&gt;
        {
          analytics.event(type, &quot;create-success&quot;, template);
          showFiles(context, project);
        });
    }
  }).Display(&quot;block&quot;);
}

function showFile(context, section, project, item, items)
{
  section.H1(item.name.toUncamelCase());
  let itemContainer = section.Div().Class(&quot;item&quot;);
  let itemContent = itemContainer.Div().Class(&quot;content&quot;);
  let itemToolbar = itemContainer.Div().Class(&quot;toolbar&quot;);
  let module = types[item.type];
  itemContent.Loader();
  items[item.key] = project.getFile(item.key);
  items[item.key].then(contents =&gt;
  {
    try
    {
      module.view(itemContent.clear(), {items, item}, contents);
    }
    catch(e)
    {
      console.error(e);
    }
    itemToolbar.Button(&quot;Rename&quot;).OnClick(() =&gt;
    {
      analytics.event(item.type, &quot;rename&quot;, &quot;attempt&quot;);
      let newName = prompt(`Please enter a new name for ${item.name}`, item.name);
      if (newName)
      {
        newName = newName.replace(/[^A-Z0-9a-z\-_]/g, &quot;&quot;);
        if (newName &amp;&amp; newName !== item.name)
        {
          let newKey = project.makeKey(newName, item.type);
          project.renameFile(item.key, newKey)
            .then(() =&gt;
            {
              analytics.event(item.type, &quot;rename&quot;, &quot;success&quot;);
              item.key = newKey;
              showFiles(context, project);
            }, err =&gt;
            {
              alert(err);
              analytics.event(item.type, &quot;rename&quot;, &quot;failure&quot;);
            });
        }
      }
    });
    itemToolbar.Button(&quot;Edit&quot;).OnClick(() =&gt;
    {
      analytics.event(item.type, &quot;edit&quot;);
      itemToolbar.Display(&quot;none&quot;);
      let editContainer = itemContent.clear().Div();
      let changed = contents;
      try
      {
        types[item.type].edit(editContainer, {items, item}, contents, update =&gt;
        {
          changed = update;
        });  
      }
      catch(e)
      {
        console.error(e);
      }
      let editToolbar = itemContent.Div();
      editToolbar.Button(&quot;Save&quot;).OnClick(() =&gt;
      {
        analytics.event(item.type, &quot;save&quot;, &quot;attempt&quot;);
        project.setFile(item.key, changed).then(() =&gt;
        {
          alert(&quot;Saved&quot;);
          contents = changed;
          analytics.event(item.type, &quot;save&quot;, &quot;success&quot;);
        }, err =&gt;
        {
          alert(err);
          analytics.event(item.type, &quot;save&quot;, &quot;failure&quot;);
        });
      });
      editToolbar.Button(&quot;Done&quot;).OnClick(() =&gt;
      {
        itemToolbar.Display(&quot;&quot;);
        if (JSON.stringify(contents) !== JSON.stringify(changed) &amp;&amp; confirm(&quot;Save changes?&quot;))
        {
          analytics.event(item.type, &quot;done&quot;, &quot;attempt&quot;);
          project.setFile(item.key, changed).then(() =&gt;
          {
            analytics.event(item.type, &quot;done&quot;, &quot;success&quot;);
            contents = changed;
            module.view(itemContent.clear(), item, contents);
          }, err =&gt;
          {
            console.error(err);
            analytics.event(item.type, &quot;done&quot;, &quot;failure&quot;);
          });
        }
        else
        {
          analytics.event(item.type, &quot;done&quot;, &quot;nochange&quot;);
          module.view(itemContent.clear(), item, contents);
        }
      });
    });
    itemToolbar.Button(&quot;Delete&quot;).OnClick(() =&gt;
    {
      analytics.event(item.type, &quot;delete&quot;, &quot;click&quot;);
      if (confirm(`Are you sure you want to delete ${item.name}?`))
      {
        analytics.event(item.type, &quot;delete&quot;, &quot;attempt&quot;);
        project.deleteFile(item.key)
          .then(() =&gt;
          {
            analytics.event(item.type, &quot;delete&quot;, &quot;success&quot;);
            showFiles(context, project);
          }, err =&gt;
          {
            analytics.event(item.type, &quot;delete&quot;, &quot;failure&quot;);
            alert(err);
          });
      }
      else
      {
        analytics.event(item.type, &quot;delete&quot;, &quot;cancel&quot;);
      }
    });
  });
}

function getTypes()
{
  let output = {};
  Object.keys(types).forEach(type =&gt; output[type] = types[type].name);
  return output;
}

function getTypeDefaults(type)
{
  let output = {};
  Object.keys(types[type].templates).forEach(template =&gt; output[template] = template.toUncamelCase());
  return output;
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
